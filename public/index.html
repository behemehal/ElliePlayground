<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-ZLTTGZYE80"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-ZLTTGZYE80");
    </script>
    <meta charset="UTF-8" />
    <!-- Facebook-->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://playground.ellie-lang.org" />
    <meta property="og:title" content="Ellie Language Playground" />
    <meta property="og:description" content="Run ellie on browser" />
    <meta
      property="og:image"
      content="https://www.ellie-lang.org/img/Social.png"
    />
    <!-- Twitter-->
    <meta property="twitter:url" content="https://playground.ellie-lang.org" />
    <meta property="twitter:title" content="Ellie Language Playground" />
    <meta property="twitter:description" content="Run ellie on browser" />
    <meta
      property="twitter:image"
      content="https://www.ellie-lang.org/img/Social.png"
    />
    <meta name="title" content="Ellie Language Playground" />
    <meta name="description" content="Run ellie on browser" />
    <meta
      name="keywords"
      content="ellie,ellie programing language,program,programing language,behemehal"
    />
    <meta name="robots" content="index, follow" />
    <meta name="copyright" content="Behemehal" />
    <meta name="language" content="English" />
    <meta name="distribution" content="global" />
    <meta name="revisit-after" content="5 days" />
    <meta name="author" content="Behemehal" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="https://www.ellie-lang.org/img/EllieCharIcon@0,1x.png"
      type="image/x-icon"
    />
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&amp;display=swap"
      rel="stylesheet"
    />
    <link href="./css/panel.css" rel="stylesheet" type="text/css" />
    <link href="./css/index.min.css" rel="stylesheet" type="text/css" />
    <link href="./css/terminal.css" rel="stylesheet" type="text/css" />
    <link href="./css/theme.min.css" rel="stylesheet" type="text/css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <title>ElliePlayground</title>
  </head>
  <body>
    <header class="pb-3 mb-4">
      <nav
        class="navbar navbar-expand-md fixed-top bg-theme navbar-theme dark-section"
      >
        <div class="container-fluid">
          <a class="navbar-brand" href="/">
            <span class="mt-5 mb-3">
              Ellie<span class="mt-5 mb-3" style="color: #884a6f"
                >Playground</span
              ></span
            >
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarCollapse"
            aria-controls="navbarCollapse"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <ul
            class="nav col-12 col-md-auto mb-2 justify-content-end mb-md-0 collapse navbar-collapse"
            id="navbarCollapse"
          >
            <li>
              <a class="nav-link px-2" href="https://www.ellie-lang.org"
                >Main Page</a
              >
            </li>
            <li>
              <a
                class="nav-link px-2"
                href="https://www.ellie-lang.org/blog.html"
                >Blog</a
              >
            </li>
            <li>
              <a
                class="nav-link px-2"
                href="https://www.ellie-lang.org/releases.html"
                >Releases</a
              >
            </li>
            <li>
              <a class="nav-link px-2" href="https://docs.ellie-lang.org"
                >Docs</a
              >
            </li>
            <li>
              <a class="nav-link px-2" href="https://lia.ellie-lang.org">Lia</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <main
      class="dark-section section"
      style="
        width: 100%;
        height: calc(100vh - 40px);
        padding-top: 15px !important;
        padding-bottom: 0 !important;
        padding-right: 0 !important;
        padding-left: 0px !important;
      "
    >
      <div class="panel">
        <div class="left_panel">
          <div id="container_left"></div>
          <div class="seperator vert">
            <span class="material-icons"> more_vert </span>
          </div>
        </div>

        <div class="right_panel">
          <div class="upper_panel">
            <div
              class="run-panel d-flex"
              style="margin-bottom: 15px; margin-top: 5px"
            >
              <div style="display: none" id="errout"></div>
              <button
                id="run_btn"
                type="button"
                style="margin-left: auto; margin-right: auto"
                class="btn btn-secondary d-flex"
              >
                <span class="material-icons"> play_arrow </span>
                <span>Run</span>
              </button>
              <button
                id="clr_btn"
                type="button"
                style="margin-left: auto; margin-right: auto"
                class="btn btn-danger d-flex"
              >
                <span class="material-icons"> delete </span>
                <span>Clear console</span>
              </button>
            </div>
            <div>
              <h3>Ellie Playground</h3>
              <details>
                <summary><span>Language Items</span></summary>
                <br />
                <ul>
                  <li>Variables</li>
                  <code>
                    v variable_type = 123;<br />
                    c constant_variable = 123;
                  </code>
                </ul>
                <ul>
                  <li>Loop</li>
                  <code>
                    v continue = true;<br />
                    loop continue {<br />
                    println("Hello World");<br />
                    }
                  </code>
                </ul>
                <ul>
                  <li>If Else</li>
                  <code>
                    if true {<br />
                    println("Hello World");<br />
                    } else if false {<br />
                    println("Hello World");<br />
                    } else {<br />
                    println("Hello World");<br />
                    }
                  </code>
                </ul>
                <ul>
                  <li>Functions</li>
                  <code>
                    pub fn function_name(parameter_name: parameter_type :
                    return_type {<br />
                    ret 123;<br />
                    }
                  </code>
                </ul>
              </details>
              <details>
                <summary><span>Types</span></summary>
                <br />
                <ul>
                  <li>Boolean</li>
                  <code> v positive: bool = true; </code>
                </ul>
                <ul>
                  <li>Integer</li>
                  <code> v age: int = 123; </code>
                </ul>
                <ul>
                  <li>Float</li>
                  <code> v pi: float = 3.14; </code>
                </ul>
                <ul>
                  <li>Double</li>
                  <code> v pi: double = 3.14; </code>
                </ul>
                <ul>
                  <li>String</li>
                  <code> v name: string = "Ellie"; </code>
                </ul>
                <ul>
                  <li>Char</li>
                  <code> v first_char: char = 'E'; </code>
                </ul>
              </details>
              <br />
              <pre style="border: 1px solid grey" id="container_right_up"></pre>
            </div>
          </div>

          <!--
            <div class="bottom_panel">
              <div id="container_right_bottom"></div>
            </div>
          -->
        </div>
      </div>
      <script src="monaco-editor/min/vs/loader.js"></script>
      <script type="module" defer>
                import init, { run } from "./js/ellie_playground.js";

                require.config({ paths: { vs: "monaco-editor/min/vs" } });
                require(["vs/editor/editor.main"], function () {
                  monaco.languages.register({
                    id: "ellie",
                    extensions: [".ellie"],
                    aliases: ["Ellie"],
                    mimes: ["text/ellie"],
                  });

                  let def = {
                    // Set defaultToken to invalid to see what you do not tokenize yet
                    // defaultToken: 'invalid',

                    keywords: [
                      "enum",
                      "loop",
                      "go",
                      "brk",
                      "new",
                      "async",
                      "await",
                      "if",
                      "else",
                      "pri",
                      "pub",
                      "ret",
                      "catch",
                      "try",
                      "c",
                      "v",
                      "import",
                      "self",
                      "for",
                      "true",
                      "false",
                      "class",
                      "extend",
                      "fn",
                    ],

                    typeKeywords: [
                      "bool",
                      "double",
                      "byte",
                      "int",
                      "float",
                      "char",
                      "void",
                      "null",
                      "string",
                      "cloak",
                      "array",
                      "vector",
                      "collective",
                    ],

                    operators: [
                      "=",
                      ">",
                      ":",
                      "<",
                      "!",
                      "~",
                      "?",
                      ":",
                      "==",
                      "<=",
                      ">=",
                      "!=",
                      "&&",
                      "||",
                      "++",
                      "--",
                      "+",
                      "-",
                      "*",
                      "/",
                      "&",
                      "|",
                      "^",
                      "%",
                      "<<",
                      ">>",
                      ">>>",
                      "+=",
                      "-=",
                      "*=",
                      "/=",
                      "&=",
                      "|=",
                      "^=",
                      "%=",
                      "<<=",
                      ">>=",
                      ">>>=",
                    ],

                    // we include these common regular expressions
                    symbols: /[=><!~?:&|+\-*\/\^%]+/,

                    // C# style strings
                    escapes:
                      /\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,

                    // The main tokenizer for our languages
                    tokenizer: {
                      root: [
                        // identifiers and keywords
                        [
                          /[a-z_$][\w$]*/,
                          {
                            cases: {
                              "@typeKeywords": "keyword",
                              "@keywords": "keyword",
                              "@default": "identifier",
                            },
                          },
                        ],
                        [/[A-Z][\w\$]*/, "type.identifier"], // to show class names nicely

                        // whitespace
                        { include: "@whitespace" },

                        // delimiters and operators
                        [/[{}()\[\]]/, "@brackets"],
                        [/[<>](?!@symbols)/, "@brackets"],
                        [
                          /@symbols/,
                          {
                            cases: {
                              "@operators": "operator",
                              "@default": "",
                            },
                          },
                        ],

                        // @ Item File Key
                        [
                          /@\s*[a-zA-Z_\$][\w\$]*/,
                          { token: "filekey", log: "annotation token: $0" },
                        ],

                        // @! Global File Key
                        [
                          /@!\s*[a-zA-Z_\$][\w\$]*/,
                          { token: "global_filekey", log: "annotation token: $0" },
                        ],

                        // numbers
                        [/\d*\.\d+([eE][\-+]?\d+)?/, "number.float"],
                        [/0[xX][0-9a-fA-F]+/, "number.hex"],
                        [/\d+/, "number"],

                        // delimiter: after number because of .\d floats
                        [/[;,.]/, "delimiter"],

                        // strings
                        [/"([^"\\]|\\.)*$/, "string.invalid"], // non-teminated string
                        [
                          /"/,
                          { token: "string.quote", bracket: "@open", next: "@string" },
                        ],

                        // characters
                        [/'[^\\']'/, "string"],
                        [/(')(@escapes)(')/, ["string", "string.escape", "string"]],
                        [/'/, "string.invalid"],
                      ],

                      comment: [
                        [/[^\/*]+/, "comment"],
                        [/\/\*/, "comment", "@push"], // nested comment
                        ["\\*/", "comment", "@pop"],
                        [/[\/*]/, "comment"],
                      ],

                      string: [
                        [/[^\\"]+/, "string"],
                        [/@escapes/, "string.escape"],
                        [/\\./, "string.escape.invalid"],
                        [
                          /"/,
                          { token: "string.quote", bracket: "@close", next: "@pop" },
                        ],
                      ],

                      whitespace: [
                        [/[ \t\r\n]+/, "white"],
                        [/\/\*/, "comment", "@comment"],
                        [/\/\/.*$/, "comment"],
                      ],
                    },
                  };

                  //Add button to monaco editor

                  monaco.languages.setMonarchTokensProvider("ellie", def);

                  monaco.languages.registerCompletionItemProvider("ellie", {
                    provideCompletionItems: function (model, position) {
                      var suggestions = [];

                      //extend array
                      def.typeKeywords.forEach(function (keyword) {
                        suggestions.push({
                          label: keyword,
                          kind: monaco.languages.CompletionItemKind.Value,
                          documentation: "",
                          insertText: keyword,
                        });
                      });

                      def.keywords.forEach(function (keyword) {
                        suggestions.push({
                          label: keyword,
                          kind: monaco.languages.CompletionItemKind.Keyword,
                          documentation: "",
                          insertText: keyword,
                        });
                      });
                      return { suggestions: suggestions };
                    },
                  });

                  var editor = monaco.editor.create(
                    document.getElementById("container_left"),
                    {
                      value: "\
fn main() {\n\
	v count = 0;\n\
	v continue = true;\n\
  //Loop until 'continue' is false\n\
	loop continue {\n\
    //If count reaches to 3\n\
    if count > 3 {\n\
      //Make continue false\n\
      continue = false;\n\
    } else {\n\
      //Print count\n\
      println(\"Count: \" + count);\n\
    }\n\
    //increment count by one\n\
    count += 1;\n\
	}\n\
}\
                      ",
                      language: "ellie",
                      theme: "vs-dark",
                    }
                  );

                  //get text of editor
                  function getText() {
                    return editor.getValue();
                  }

                  window.ddd = monaco;
                  init()
                    .then(() => {
                      document.getElementById("clr_btn").onclick = () => {
                        document.getElementById("container_right_up").innerHTML =
                          '<p class="termGreen">Console Cleaned</p>';
                      };

                      document.getElementById("run_btn").onclick = () => {
                        let text = getText();
                        console.log("run", text);
                        let time_now = new Date().getTime();
                        run(text);
                        let time_end = new Date().getTime();
                        window.run = run;

                        document.getElementById("container_right_up").innerHTML +=
                          '<br><p class="termGreen">Completed in: ' +
                          (time_end - time_now) / 1000 +
                          "s</p>";

                        let markers = [];
                        let outputs = [
                          ...document.getElementById("errout").children,
                        ].map((x) => {
                          try {
                            return JSON.parse(x.innerText);
                          } catch (_) {
                            console.log("error", x.innerText);
                            return {};
                          }
                        });

                        for (let i = 0; i < outputs.length; i++) {
                          let output = outputs[i];
                          if (output.message_type == "warning") {
                            let warning = {
                              startLineNumber: output.range_start[0],
                              endLineNumber: output.range_end[0],
                              startColumn: output.range_start[1],
                              endColumn: output.range_end[1],
                              message: output.message,
                              severity: monaco.MarkerSeverity.Warning,
                            };

                            if (output.reference != false) {
                              warning["relatedInformation"] = [
                                {
                                  startLineNumber: output.reference.range_start[0],
                                  endLineNumber: output.reference.range_end[0],
                                  startColumn: output.reference.range_start[1],
                                  endColumn: output.reference.range_end[1],
                                  message: output.reference.message,
                                },
                              ];
                            }

                            markers.push(warning);
                          } else if (output.message_type == "error") {
                            let error = {
                              startLineNumber: output.range_start[0],
                              endLineNumber: output.range_end[0],
                              startColumn: output.range_start[1],
                              endColumn: output.range_end[1],
                              message: output.message,
                              severity: monaco.MarkerSeverity.Error,
                            };

                            if (output.reference != false) {
                              error["relatedInformation"] = [
                                {
                                  startLineNumber: output.reference.range_start[0],
                                  endLineNumber: output.reference.range_end[0],
                                  startColumn: output.reference.range_start[1],
                                  endColumn: output.reference.range_end[1],
                                  message: output.reference.message,
                                },
                              ];
                            }
                            markers.push(error);
                          }
                        }
                        document.getElementById("errout").innerHTML = "";
                        monaco.editor.setModelMarkers(
                          editor.getModel(),
                          "ellie",
                          markers
                        );
                      };
                    })
                    .catch((err) => {
                      console.error(err);
                    });
                });
      </script>
    </main>
  </body>
</html>
